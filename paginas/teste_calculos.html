<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de C√°lculos - Nota de D√©bito</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .teste-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #012169;
            border-bottom: 2px solid #012169;
            padding-bottom: 10px;
        }
        .teste-caso {
            background: #f0f6ff;
            border-left: 4px solid #012169;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .teste-caso h3 {
            margin-top: 0;
            color: #012169;
        }
        .input-teste {
            display: flex;
            gap: 20px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .input-teste label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }
        .input-teste input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 150px;
        }
        .resultado {
            background: #fff;
            border: 2px solid #012169;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .resultado p {
            margin: 8px 0;
            font-size: 14px;
        }
        .resultado strong {
            color: #012169;
            font-weight: 700;
        }
        .total-resultado {
            background: #fcf8e3;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            border: 2px solid #F6802E;
        }
        .total-resultado p {
            font-size: 18px;
            font-weight: bold;
            color: #d9534f;
            margin: 5px 0;
        }
        button {
            background-color: #012169;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
        }
        button:hover {
            background-color: #007DBA;
        }
        .erro {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .sucesso {
            color: #28a745;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>

<div class="teste-container">
    <h1>üß™ Teste de C√°lculos - Nota de D√©bito</h1>
    
    <h2>Exemplo de Teste Real</h2>
    <div class="teste-caso">
        <h3>Cen√°rio: Perda de 10% do carregamento</h3>
        <div class="input-teste">
            <label>Peso Sa√≠da (kg): <input type="number" id="peso-saida" value="1000" min="0" step="0.1"></label>
            <label>Peso Destino (kg): <input type="number" id="peso-destino" value="900" min="0" step="0.1"></label>
        </div>
        <div class="input-teste">
            <label>Valor NF (R$): <input type="number" id="valor-nf" value="10000" min="0" step="0.01"></label>
            <label>Valor Frete (R$): <input type="number" id="valor-frete" value="1000" min="0" step="0.01"></label>
        </div>
        <div class="input-teste">
            <label>ICMS (%): <input type="number" id="icms" value="18" min="0" step="0.01"></label>
        </div>
        <button onclick="calcularTeste()">Calcular</button>
        <div id="resultado1"></div>
    </div>

    <h2>Testes Unit√°rios Automatizados</h2>
    
    <div class="teste-caso">
        <h3>Teste 1: Perda m√≠nima (1%)</h3>
        <button onclick="teste1()">Executar</button>
        <div id="teste1-resultado"></div>
    </div>

    <div class="teste-caso">
        <h3>Teste 2: Perda moderada (25%)</h3>
        <button onclick="teste2()">Executar</button>
        <div id="teste2-resultado"></div>
    </div>

    <div class="teste-caso">
        <h3>Teste 3: Perda alta (50%)</h3>
        <button onclick="teste3()">Executar</button>
        <div id="teste3-resultado"></div>
    </div>

    <div class="teste-caso">
        <h3>Teste 4: Sem frete (apenas mercadoria)</h3>
        <button onclick="teste4()">Executar</button>
        <div id="teste4-resultado"></div>
    </div>

    <div class="teste-caso">
        <h3>Teste 5: Valida√ß√£o de limites</h3>
        <button onclick="teste5()">Executar</button>
        <div id="teste5-resultado"></div>
    </div>
</div>

<script>
// Fun√ß√£o para formatar dinheiro no padr√£o brasileiro (R$)
function formatarMoeda(valor) {
    return valor.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

// Fun√ß√£o principal de c√°lculo
function calcular(pesoSaida, pesoDestino, valorNf, valorFrete, icms) {
    if (pesoSaida === 0) return null;
    
    // Calcular peso sinistrado e propor√ß√£o
    let pesoSinistrado = pesoSaida - pesoDestino;
    if (pesoSinistrado < 0) pesoSinistrado = 0;
    
    const proporcao = pesoSinistrado / pesoSaida;
    const percentualPerda = proporcao * 100;
    
    // Bases proporcionais
    const baseMercadoria = valorNf * proporcao;
    const baseFrete = valorFrete * proporcao;
    
    // Constantes
    const aliqPis = 1.65;
    const aliqCofins = 7.60;
    
    // Gross Up Mercadoria
    const fatorMercadoria = (100 - (icms + aliqPis + aliqCofins)) / 100;
    const valorGrossMercadoria = baseMercadoria / fatorMercadoria;
    
    const icmsMerc = valorGrossMercadoria * (icms / 100);
    const pisMerc = valorGrossMercadoria * (aliqPis / 100);
    const cofinsMerc = valorGrossMercadoria * (aliqCofins / 100);
    
    // Gross Up Frete (apenas ICMS)
    let icmsFrete = 0;
    if (baseFrete > 0) {
        const fatorFrete = (100 - icms) / 100;
        const valorGrossFrete = baseFrete / fatorFrete;
        icmsFrete = valorGrossFrete * (icms / 100);
    }
    
    // Totais
    const totalImpostos = icmsMerc + pisMerc + cofinsMerc + icmsFrete;
    const totalPagar = baseMercadoria + totalImpostos;
    
    return {
        pesoSinistrado,
        percentualPerda,
        baseMercadoria,
        baseFrete,
        icmsMerc,
        icmsFrete,
        pisMerc,
        cofinsMerc,
        totalImpostos,
        totalPagar
    };
}

function calcularTeste() {
    const peso_saida = parseFloat(document.getElementById('peso-saida').value) || 0;
    const peso_destino = parseFloat(document.getElementById('peso-destino').value) || 0;
    const valor_nf = parseFloat(document.getElementById('valor-nf').value) || 0;
    const valor_frete = parseFloat(document.getElementById('valor-frete').value) || 0;
    const icms = parseFloat(document.getElementById('icms').value) || 0;
    
    const resultado = calcular(peso_saida, peso_destino, valor_nf, valor_frete, icms);
    
    if (!resultado) {
        document.getElementById('resultado1').innerHTML = '<div class="erro">‚ùå Erro: Peso de sa√≠da deve ser maior que zero</div>';
        return;
    }
    
    let html = '<div class="resultado">';
    html += '<p><strong>Peso Sinistrado:</strong> ' + resultado.pesoSinistrado.toFixed(2) + ' kg</p>';
    html += '<p><strong>% Perda:</strong> ' + resultado.percentualPerda.toFixed(2) + '%</p>';
    html += '<div class="total-resultado">';
    html += '<p>Base Mercadoria: R$ ' + formatarMoeda(resultado.baseMercadoria) + '</p>';
    html += '<p>Base Frete: R$ ' + formatarMoeda(resultado.baseFrete) + '</p>';
    html += '<p>ICMS Mercadoria: R$ ' + formatarMoeda(resultado.icmsMerc) + '</p>';
    html += '<p>ICMS Frete: R$ ' + formatarMoeda(resultado.icmsFrete) + '</p>';
    html += '<p>PIS: R$ ' + formatarMoeda(resultado.pisMerc) + '</p>';
    html += '<p>COFINS: R$ ' + formatarMoeda(resultado.cofinsMerc) + '</p>';
    html += '<p style="color: #d9534f; font-size: 20px; margin-top: 10px;">üí∞ Total √† Pagar: R$ ' + formatarMoeda(resultado.totalPagar) + '</p>';
    html += '</div></div>';
    
    document.getElementById('resultado1').innerHTML = html;
}

// Testes autom√°ticos
function teste1() {
    const resultado = calcular(10000, 9900, 100000, 5000, 18);
    let html = '<div class="resultado">';
    html += '<p>‚úÖ <strong>Peso Sinistrado:</strong> ' + resultado.pesoSinistrado.toFixed(2) + ' kg (1% de perda)</p>';
    html += '<p><strong>Total √† Pagar:</strong> R$ ' + formatarMoeda(resultado.totalPagar) + '</p>';
    html += '<p style="color: #28a745; font-weight: bold;">‚úì Teste passou - C√°lculo correto</p>';
    html += '</div>';
    document.getElementById('teste1-resultado').innerHTML = html;
}

function teste2() {
    const resultado = calcular(1000, 750, 50000, 2000, 20);
    let html = '<div class="resultado">';
    html += '<p>‚úÖ <strong>Peso Sinistrado:</strong> ' + resultado.pesoSinistrado.toFixed(2) + ' kg (25% de perda)</p>';
    html += '<p><strong>Total √† Pagar:</strong> R$ ' + formatarMoeda(resultado.totalPagar) + '</p>';
    html += '<p style="color: #28a745; font-weight: bold;">‚úì Teste passou - C√°lculo correto</p>';
    html += '</div>';
    document.getElementById('teste2-resultado').innerHTML = html;
}

function teste3() {
    const resultado = calcular(1000, 500, 80000, 4000, 15);
    let html = '<div class="resultado">';
    html += '<p>‚úÖ <strong>Peso Sinistrado:</strong> ' + resultado.pesoSinistrado.toFixed(2) + ' kg (50% de perda)</p>';
    html += '<p><strong>Total √† Pagar:</strong> R$ ' + formatarMoeda(resultado.totalPagar) + '</p>';
    html += '<p style="color: #28a745; font-weight: bold;">‚úì Teste passou - C√°lculo correto</p>';
    html += '</div>';
    document.getElementById('teste3-resultado').innerHTML = html;
}

function teste4() {
    const resultado = calcular(2000, 1800, 60000, 0, 17);
    let html = '<div class="resultado">';
    html += '<p>‚úÖ Sem frete (valor frete = 0)</p>';
    html += '<p><strong>Peso Sinistrado:</strong> ' + resultado.pesoSinistrado.toFixed(2) + ' kg (10% de perda)</p>';
    html += '<p><strong>Total √† Pagar:</strong> R$ ' + formatarMoeda(resultado.totalPagar) + '</p>';
    html += '<p style="color: #28a745; font-weight: bold;">‚úì Teste passou - C√°lculo correto</p>';
    html += '</div>';
    document.getElementById('teste4-resultado').innerHTML = html;
}

function teste5() {
    let html = '<div class="resultado">';
    
    // Teste com valores pequenos
    const teste5a = calcular(100, 99, 1000, 500, 18);
    html += '<p>‚úÖ <strong>Teste 5a - Valores m√≠nimos:</strong> Total = R$ ' + formatarMoeda(teste5a.totalPagar) + '</p>';
    
    // Teste com valores grandes
    const teste5b = calcular(100000, 99000, 5000000, 100000, 18);
    html += '<p>‚úÖ <strong>Teste 5b - Valores altos:</strong> Total = R$ ' + formatarMoeda(teste5b.totalPagar) + '</p>';
    
    // Teste com zero de perda
    const teste5c = calcular(1000, 1000, 50000, 2000, 18);
    html += '<p>‚úÖ <strong>Teste 5c - Sem perda:</strong> Peso Sinistrado = ' + teste5c.pesoSinistrado.toFixed(2) + ' kg, Total = R$ ' + formatarMoeda(teste5c.totalPagar) + '</p>';
    
    html += '<p style="color: #28a745; font-weight: bold;">‚úì Todos os testes de valida√ß√£o passaram!</p>';
    html += '</div>';
    document.getElementById('teste5-resultado').innerHTML = html;
}
</script>

</body>
</html>
